"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[363],{8519:function(e,a,n){n.r(a),n.d(a,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return m},assets:function(){return d},toc:function(){return h},SBTInstallCodeBlock:function(){return k},default:function(){return g}});var t=n(2685),i=n(1244),o=(n(7378),n(5318)),s=n(4014),r=n(5596),c=["components"],l={id:"as-scala-library",title:"As Scala Library"},p=void 0,m={unversionedId:"usage/as-scala-library",id:"usage/as-scala-library",title:"As Scala Library",description:"const version = useDocusaurusContext().siteConfig.customFields.version;",source:"@site/docs/usage/as-scala-library.mdx",sourceDirName:"usage",slug:"/usage/as-scala-library",permalink:"/recheck/docs/usage/as-scala-library",editUrl:"https://github.com/makenowjust-labs/recheck/tree/main/website/docs/usage/as-scala-library.mdx",tags:[],version:"current",frontMatter:{id:"as-scala-library",title:"As Scala Library"},sidebar:"docs",previous:{title:"As JavaScript Library",permalink:"/recheck/docs/usage/as-javascript-library"},next:{title:"As ESLint Plugin",permalink:"/recheck/docs/usage/as-eslint-plugin"}},d={},h=[{value:"Install",id:"install",level:2},{value:"Usage",id:"usage",level:2},{value:"Cancel",id:"cancel",level:3}],k=function(){var e=(0,s.Z)().siteConfig.customFields.version;return(0,o.kt)(r.Z,{title:"build.sbt",className:"language-scala",mdxType:"CodeBlock"},'libraryDependencies += "codes.quine.labs" %% "recheck-core" % "',e,'"')},u={toc:h,SBTInstallCodeBlock:k};function g(e){var a=e.components,n=(0,i.Z)(e,c);return(0,o.kt)("wrapper",(0,t.Z)({},u,n,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Describes how to use ",(0,o.kt)("inlineCode",{parentName:"p"},"recheck")," as a Scala library."),(0,o.kt)("h2",{id:"install"},"Install"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://search.maven.org/artifact/codes.quine.labs/recheck-core_2.13"},(0,o.kt)("img",{parentName:"a",src:"https://img.shields.io/maven-central/v/codes.quine.labs/recheck-core_2.13?logo=scala&style=for-the-badge",alt:"Maven Central"}))),(0,o.kt)("p",null,"To install the Scala library of ",(0,o.kt)("inlineCode",{parentName:"p"},"recheck"),", you should append the following line into your ",(0,o.kt)("inlineCode",{parentName:"p"},"build.sbt"),"."),(0,o.kt)(k,{mdxType:"SBTInstallCodeBlock"}),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"ReDoS.check")," is the only entry point for checking the vulnerability of regular expression."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'import codes.quine.labs.recheck.ReDoS\n\nReDoS.check("^(a|a)*$", "")\n')),(0,o.kt)("p",null,"The first argument of ",(0,o.kt)("inlineCode",{parentName:"p"},"ReDoS.check")," is the ",(0,o.kt)("inlineCode",{parentName:"p"},"source")," which is corresponding to ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/source"},(0,o.kt)("inlineCode",{parentName:"a"},"RegExp.prototype.source")),".\nAnd, the second argument is the ",(0,o.kt)("inlineCode",{parentName:"p"},"flags")," which is corresponding to ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/flags"},(0,o.kt)("inlineCode",{parentName:"a"},"RegExp.prototype.flags"))," too.\nThe third argument is the ",(0,o.kt)("inlineCode",{parentName:"p"},"params")," to specify parameters for the checker behavior, and the fourth is the ",(0,o.kt)("inlineCode",{parentName:"p"},"token")," to cancel the checking in the middle."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"See ",(0,o.kt)("a",{parentName:"p",href:"/recheck/docs/usage/parameters"},"this page")," for detailed information on ",(0,o.kt)("inlineCode",{parentName:"p"},"Parameters")," value."))),(0,o.kt)("p",null,"The result of ",(0,o.kt)("inlineCode",{parentName:"p"},"ReDoS.check")," is called ",(0,o.kt)("inlineCode",{parentName:"p"},"Diagnostics"),".\n",(0,o.kt)("inlineCode",{parentName:"p"},"Diagnostics")," is a ",(0,o.kt)("inlineCode",{parentName:"p"},"sealed class"),", and it has three child classes."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Diagnostics.Safe")," means the given regular expression seems safe at least in this checking."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Diagnostics.Vulnerable")," means vulnerability in the given regular expression is found."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Diagnostics.Unknown")," means something wrong happened in checking (timeout, cancel, or error).")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"See ",(0,o.kt)("a",{parentName:"p",href:"/recheck/docs/usage/diagnostics"},"this page")," for detailed information on ",(0,o.kt)("inlineCode",{parentName:"p"},"Diagnostics")," value."))),(0,o.kt)("h3",{id:"cancel"},"Cancel"),(0,o.kt)("p",null,"The fourth argument of ",(0,o.kt)("inlineCode",{parentName:"p"},"ReDoS.check")," is used to cancel the checking in the middle.\nThis type is ",(0,o.kt)("inlineCode",{parentName:"p"},"CancellationToken")," which is created by ",(0,o.kt)("inlineCode",{parentName:"p"},"CancellationTokenSource"),".\nNoting that ",(0,o.kt)("inlineCode",{parentName:"p"},"ReDoS.check")," blocks the process, you should use this with concurrent libraries like ",(0,o.kt)("inlineCode",{parentName:"p"},"scala.concurrent"),"or ",(0,o.kt)("a",{parentName:"p",href:"https://typelevel.org/cats-effect/"},(0,o.kt)("inlineCode",{parentName:"a"},"cats-effect")),"."),(0,o.kt)("p",null,"The following example is usage with ",(0,o.kt)("inlineCode",{parentName:"p"},"cats-effect"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'import scala.concurrent.duration._\n\nimport cats.effect._\nimport cats.effect.unsafe.implicits.global\n\nimport codes.quine.labs.recheck.ReDoS\nimport codes.quine.labs.recheck.common.CancellationTokenSource\nimport codes.quine.labs.recheck.common.Parameters\nimport codes.quine.labs.recheck.diagnostics.Diagnostics\n\nval cancellation = new CancellationTokenSource\n\nval io = for {\n  fiber <- IO(ReDoS.check("^a+a+$", "", Parameters(), Some(cancellation.token))).start\n  _ <- (IO.sleep(100.millisecond) *> IO(cancellation.cancel())).start\n  diagnostics <- fiber.joinWithNever\n  _ <- IO.println(diagnostics)\n} yield ()\n\nio.unsafeRunSync()\n')),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"There is the ",(0,o.kt)("inlineCode",{parentName:"p"},"timeout")," parameter to specify timeout seconds.\nPlease use this instead of the manual way."))),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The above example does not work with ",(0,o.kt)("inlineCode",{parentName:"p"},"cats-effect")," better actually, because ",(0,o.kt)("inlineCode",{parentName:"p"},"fiber")," has ",(0,o.kt)("inlineCode",{parentName:"p"},"cancel")," method and it does not work with this method."),(0,o.kt)("p",{parentName:"div"},"To fix this problem, we can use ",(0,o.kt)("inlineCode",{parentName:"p"},"IO.async"),". The following is the complete example. However, by ",(0,o.kt)("inlineCode",{parentName:"p"},"cats-effect")," restriction, it will lose a result diagnostics when a fiber is cancelled."),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'import scala.concurrent.duration._\n\nimport cats.effect._\nimport cats.effect.unsafe.implicits.global\n\nimport codes.quine.labs.recheck.ReDoS\nimport codes.quine.labs.recheck.common.CancellationTokenSource\nimport codes.quine.labs.recheck.common.Parameters\nimport codes.quine.labs.recheck.diagnostics.Diagnostics\n\ndef cancelableCheck(source: String, flags: String, params: Parameters): IO[Diagnostics] =\n  IO.executionContext.flatMap { ec =>\n    IO.async { cb =>\n      IO {\n        val cancellation = new CancellationTokenSource\n        ec.execute(() => {\n          val diagnostics = ReDoS.check(source, flags, params, Some(cancellation.token))\n          cb(Right(diagnostics))\n        })\n        Some(IO(cancellation.cancel()))\n      }\n    }\n  }\n\nval io = for {\n  fiber <- cancelableCheck("^a+a+$", "", Parameters()).start\n  _ <- (IO.sleep(100.millisecond) *> fiber.cancel).start\n  diagnostics <- fiber.join\n  _ <- IO.println(diagnostics)\n} yield ()\n\nio.unsafeRunSync()\n')))))}g.isMDXComponent=!0}}]);